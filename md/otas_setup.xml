<?xml version="1.0" encoding="utf-8"?>
<mdscript xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" name="otas_setup" xsi:noNamespaceSchemaLocation="md.xsd">
	<cues>
		<!-- First time run after mod activation -->
		<cue name="otas_setup_root" namespace="this" >
			<conditions>
					<event_cue_signalled cue="md.Setup.Start"/>
			</conditions>
			<actions>			
			</actions>
		</cue>
		
		<!-- new game -->
		<cue name="otas_setup_start" namespace="this">
			<conditions>
				<event_cue_completed cue="otas_setup_root"/>			
            </conditions>
			<actions>
				<include_actions ref="Start_Actions"/>
				<cancel_cue cue="otas_setup_game_loaded"/>
			</actions>
		</cue>
		<!-- savegame -->
		<cue name="otas_setup_game_loaded" namespace="this">
			<conditions>
				<event_game_loaded/>
			</conditions>
			<delay exact="15ms"/>
			<actions>
				<include_actions ref="Start_Actions"/>				
				<cancel_cue cue="otas_setup_start"/>
			</actions>
		</cue>

		<library name="Start_Actions">
			<actions>
				<!-- <set_value name="$DebugChance" exact="100"/> -->
				
				<debug_to_file text="this.name + ' - ' + 'otas'" name="'otas_setup.log'" directory="'otas'" chance="$DebugChance" />	
				<do_if value="not md.$EquipmentTable?">
					<set_value name="md.$EquipmentTable" exact="table[]"/>
				</do_if>
				<get_ware_definition result="md.$EquipmentTable.{faction.otas}" faction="faction.otas" flags="equipment" />
				
				<do_if value="not md.$FactionData?">
					<set_value name="md.$FactionData" exact="table[]"/>
				</do_if>
				<do_if value="not md.$FactionData.{faction.otas}?">
				  <set_value name="md.$FactionData.{faction.otas}" exact="table[]" />
				</do_if>
				
				<set_faction_relation faction="faction.otas" otherfaction="faction.argon" value="-0.1"/>
				<set_faction_relation faction="faction.otas" otherfaction="faction.antigone" value="-0.032"/>
				<set_faction_relation faction="faction.otas" otherfaction="faction.alliance" value="0.032"/>
				<set_faction_relation faction="faction.otas" otherfaction="faction.hatikvah" value="-0.032"/>
				<set_faction_relation faction="faction.otas" otherfaction="faction.paranid" value="0.032"/>
				<set_faction_relation faction="faction.otas" otherfaction="faction.holyorder" value="-0.032"/>
				<set_faction_relation faction="faction.otas" otherfaction="faction.scaleplate" value="-0.32"/>
				<set_faction_relation faction="faction.otas" otherfaction="faction.teladi" value="0.032"/>
				<set_faction_relation faction="faction.otas" otherfaction="faction.criminal" value="-0.5"/>
				<set_faction_relation faction="faction.otas" otherfaction="faction.smuggler" value="-0.5"/>
				<set_faction_relation faction="faction.criminal" otherfaction="faction.otas" value="-0.5"/>
				<set_faction_relation faction="faction.smuggler" otherfaction="faction.otas" value="-0.5"/>
				<do_if value="ware.cheltmeat?" comment="detect split dlc">
					<set_faction_relation faction="faction.otas" otherfaction="faction.court" value="-0.032"/>
					<set_faction_relation faction="faction.otas" otherfaction="faction.fallensplit" value="-0.32"/>
					<set_faction_relation faction="faction.otas" otherfaction="faction.freesplit" value="-0.032"/>
					<set_faction_relation faction="faction.otas" otherfaction="faction.split" value="0.032"/>							
				</do_if>
				<do_if value="ware.ship_atf_xl_battleship_01_a?" comment="detect terran dlc">
					<set_faction_relation faction="faction.otas" otherfaction="faction.terran" value="-0.06"/>
					<set_faction_relation faction="faction.otas" otherfaction="faction.yaki" value="-0.32"/>
					<set_faction_relation faction="faction.otas" otherfaction="faction.pioneers" value="0.032"/>
					<set_faction_relation faction="faction.terran" otherfaction="faction.otas" value="-0.06"/>
					<set_faction_relation faction="faction.pioneers" otherfaction="faction.otas" value="0.032"/>
					<set_faction_relation faction="faction.yaki" otherfaction="faction.otas" value="-0.32"/>							
				</do_if>
				<do_if value="ware.ship_pir_xl_battleship_01_a?" comment="detect pirate dlc">
					<set_faction_relation faction="faction.otas" otherfaction="faction.loanshark" value="-0.06"/>
					<set_faction_relation faction="faction.otas" otherfaction="faction.scavenger" value="0.06"/>
					<set_faction_relation faction="faction.loanshark" otherfaction="faction.otas" value="-0.06"/>
					<set_faction_relation faction="faction.scavenger" otherfaction="faction.otas" value="0.06"/>
				</do_if>
				<do_if value="faction.boron?">
					<set_faction_relation faction="faction.otas" otherfaction="faction.boron" value="-0.032"/>
					<set_faction_relation faction="faction.boron" otherfaction="faction.otas" value="-0.032"/>
				</do_if>				
							
				<!-- If Thuruk's Demise exists then check licences,add available and create station-->
				<find_cluster name="$otas_cluster" space="player.galaxy" macro="macro.Cluster_REM53_Sector001_macro"/>
				<debug_to_file text="this.name + ' - ' + 'Sector: %1'.[$otas_cluster]" name="'otas_setup.log'" directory="'otas'" chance="$DebugChance" />	
				<do_if value="$otas_cluster">
					
					<set_faction_known faction="faction.otas" known="true"/>									
					<set_value name="$Faction" exact="faction.otas"/>
					<do_all exact="$Faction.licences.count" counter="$i">
						<set_value name="$licence" exact="$Faction.licences.{$i}"/>
						<do_if value="faction.player.canholdlicence.{$licence} and $licence.price == 0">
							<add_licence licence="$licence"/>
						</do_if>
					</do_all>
					
					<signal_cue cue="md.otas_stations.root"/>
				</do_if>				
			</actions>
		</library>
	</cues>
</mdscript>